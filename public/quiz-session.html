<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í€´ì¦ˆ ì„¸ì…˜</title>
</head>
<body>
    
  <h1>ì‹¤ì‹œê°„ í€´ì¦ˆ ì„¸ì…˜</h1>
  <div id="questionBox"></div>
  <!-- ì±„íŒ… ì˜ì—­ -->
  <div id="chatLog"></div>
  <input type="text" id="chatInput" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”">
  <button onclick="sendMessage()">ì „ì†¡</button>
  <h1>ì´ˆëŒ€ì½”ë“œ: <span id="inviteCode">ë¡œë”©ì¤‘...</span></h1>
  

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const sessionId = new URLSearchParams(window.location.search).get('id');
    const username = localStorage.getItem('username') || 'ìµëª…';
    console.log('[debug] username:', username);
      // ì„¸ì…˜ ì…ì¥
    socket.emit('joinSession', { sessionId, username });

    //ì´ˆëŒ€ì½”ë“œ í‘œì‹œ
    fetch(`/game/session/${sessionId}`)
      .then(res => res.json())
      .then(data => {
        const inviteCode = data.inviteCode || 'ì—†ìŒ';
        document.getElementById('inviteCode').textContent = inviteCode;
      })
      .catch(err => {
        console.error('ì„¸ì…˜ ì •ë³´ ìš”ì²­ ì‹¤íŒ¨:', err);
      });

     // ì±„íŒ… ë©”ì‹œì§€ ìˆ˜ì‹ 
    socket.on('chat', ({ user, message }) => {
        const chatLog = document.getElementById('chatLog');
        const p = document.createElement('p');
        p.innerHTML = `<strong>${user}</strong>: ${message}`;
        chatLog.appendChild(p);
    });

    // ì •ë‹µ ì•Œë¦¼ ìˆ˜ì‹ 
    socket.on('correct', ({ username }) => {
        const chatLog = document.getElementById('chatLog');
        const p = document.createElement('p');
        p.innerHTML = `<strong>${username}</strong>ë‹˜ì´ ì •ë‹µì„ ë§í˜”ìŠµë‹ˆë‹¤! ğŸ‰`;
        chatLog.appendChild(p);
    });

    // ë©”ì‹œì§€ ì „ì†¡
    function sendMessage() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        if (message) {
        socket.emit('chatMessage', { sessionId, username, message });
        input.value = '';
        }
    }

    socket.on('next', ({ index }) => {
        currentIndex = index;
        showQuestion();
        });

    socket.on('end', ({ message }) => {
        alert(message || 'í€´ì¦ˆê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        });
  </script>
</body>
</html>
