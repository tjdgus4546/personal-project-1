<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayCode 내 정보 수정</title>
    <link rel="icon" href="/images/Logo.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/css/common.css">
</head>
<body class="bg-[#222230] text-white min-h-screen">
    <!-- 상단바가 여기에 자동으로 삽입됩니다 -->
    
    <div class="max-w-2xl mx-auto px-4 py-8">
        <!-- 로딩 상태 -->
        <div id="loadingSection" class="text-center py-12">
            <div class="inline-flex items-center space-x-2 text-gray-300">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-white"></div>
                <span>사용자 정보를 불러오는 중...</span>
            </div>
        </div>

        <!-- 수정 폼 섹션 -->
        <div id="editFormSection" class="hidden">
            <!-- 헤더 -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">내 정보 수정</h1>
                <p class="text-gray-400">개인정보를 안전하게 수정하세요</p>
            </div>

            <!-- 알림 메시지 -->
            <div id="alertContainer" class="mb-6"></div>

            <!-- 수정 폼 -->
            <div class="bg-[#2d2d3d] rounded-2xl p-8 shadow-2xl border border-gray-600">
                <form id="editProfileForm" class="space-y-6">
                    
                    <!-- 프로필 이미지 섹션 -->
                    <div class="text-center mb-8">
                        <div class="flex flex-col items-center space-y-4">
                            <div class="relative">
                                <div id="currentProfileImage" class="w-24 h-24 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-2xl font-bold border-4 border-white/20">
                                    <!-- 현재 프로필 이미지 -->
                                </div>
                                
                                <!-- 이미지 변경 버튼 -->
                                <button 
                                    type="button"
                                    id="changeImageBtn"
                                    class="absolute -bottom-2 -right-2 bg-blue-500 hover:bg-blue-600 text-white rounded-full p-2 shadow-lg transition-all duration-200 transform hover:scale-110"
                                    title="프로필 이미지 변경"
                                >
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                </button>
                                
                                <!-- 숨겨진 파일 입력 -->
                                <input 
                                    type="file" 
                                    id="profileImageInput" 
                                    accept="image/*" 
                                    class="hidden"
                                >
                            </div>
                            
                            <div id="profileImageInfo" class="text-sm text-gray-400 text-center">
                                <!-- 이미지 정보가 여기에 표시됩니다 -->
                            </div>
                            
                            <!-- 이미지 미리보기 및 제거 버튼 -->
                            <div id="imagePreviewSection" class="hidden space-y-3">
                                <div class="bg-[#3a3a4a] rounded-lg p-4">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div id="newImagePreview" class="w-12 h-12 rounded-full bg-gray-600 flex-shrink-0 overflow-hidden">
                                                <!-- 새 이미지 미리보기 -->
                                            </div>
                                            <div>
                                                <p class="text-white text-sm font-medium">새 프로필 이미지</p>
                                                <p id="imageFileInfo" class="text-gray-400 text-xs">-</p>
                                            </div>
                                        </div>
                                        <button 
                                            type="button" 
                                            id="removeNewImageBtn"
                                            class="text-red-400 hover:text-red-300 transition-colors"
                                            title="이미지 제거"
                                        >
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 현재 이미지 제거 버튼 (커스텀 이미지가 있는 경우만) -->
                            <div id="currentImageActions" class="hidden">
                                <button 
                                    type="button" 
                                    id="removeCurrentImageBtn"
                                    class="text-red-400 hover:text-red-300 text-sm transition-colors flex items-center space-x-1"
                                >
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                    <span>현재 이미지 제거</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 기본 정보 -->
                    <div class="space-y-6">
                        <h3 class="text-lg font-semibold text-white border-b border-gray-600 pb-2">기본 정보</h3>
                        
                        <!-- 실명 (읽기 전용) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-2">
                                이름
                                <span class="text-xs text-gray-500 ml-2">(변경 불가)</span>
                            </label>
                            <input 
                                type="text" 
                                id="username"
                                class="w-full px-4 py-3 bg-[#3a3a4a] border border-gray-600 rounded-lg text-gray-400 cursor-not-allowed"
                                readonly
                            >
                        </div>

                        <!-- 닉네임 -->
                        <div>
                            <label for="nickname" class="block text-sm font-medium text-gray-400 mb-2">
                                닉네임 *
                                <span class="text-xs text-gray-500 ml-2">(게임에서 표시되는 이름)</span>
                            </label>
                            <input 
                                type="text" 
                                id="nickname"
                                name="nickname"
                                required
                                maxlength="20"
                                class="w-full px-4 py-3 bg-[#3a3a4a] border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-green-500 focus:ring-2 focus:ring-green-500 focus:ring-opacity-20 transition-all duration-300"
                                placeholder="사용할 닉네임을 입력하세요"
                            >
                            <div class="flex justify-between items-center mt-1">
                                <p class="text-xs text-gray-500">2-20글자, 영문/한글/숫자 사용 가능</p>
                                <span id="nicknameLength" class="text-xs text-gray-500">0/20</span>
                            </div>
                        </div>

                        <!-- 이메일 (읽기 전용) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-400 mb-2">
                                이메일
                                <span class="text-xs text-gray-500 ml-2">(변경 불가)</span>
                            </label>
                            <input 
                                type="email" 
                                id="email"
                                class="w-full px-4 py-3 bg-[#3a3a4a] border border-gray-600 rounded-lg text-gray-400 cursor-not-allowed"
                                readonly
                            >
                        </div>
                    </div>

                    <!-- 비밀번호 변경 (일반 가입자만) -->
                    <div id="passwordSection" class="space-y-6">
                        <h3 class="text-lg font-semibold text-white border-b border-gray-600 pb-2">비밀번호 변경</h3>
                        
                        <!-- 현재 비밀번호 -->
                        <div>
                            <label for="currentPassword" class="block text-sm font-medium text-gray-400 mb-2">
                                현재 비밀번호
                            </label>
                            <input 
                                type="password" 
                                id="currentPassword"
                                name="currentPassword"
                                class="w-full px-4 py-3 bg-[#3a3a4a] border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-green-500 focus:ring-2 focus:ring-green-500 focus:ring-opacity-20 transition-all duration-300"
                                placeholder="현재 비밀번호를 입력하세요"
                            >
                        </div>

                        <!-- 새 비밀번호 -->
                        <div>
                            <label for="newPassword" class="block text-sm font-medium text-gray-400 mb-2">
                                새 비밀번호
                            </label>
                            <input 
                                type="password" 
                                id="newPassword"
                                name="newPassword"
                                class="w-full px-4 py-3 bg-[#3a3a4a] border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-green-500 focus:ring-2 focus:ring-green-500 focus:ring-opacity-20 transition-all duration-300"
                                placeholder="새 비밀번호를 입력하세요 (6글자 이상)"
                            >
                        </div>

                        <!-- 새 비밀번호 확인 -->
                        <div>
                            <label for="confirmPassword" class="block text-sm font-medium text-gray-400 mb-2">
                                새 비밀번호 확인
                            </label>
                            <input 
                                type="password" 
                                id="confirmPassword"
                                name="confirmPassword"
                                class="w-full px-4 py-3 bg-[#3a3a4a] border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-green-500 focus:ring-2 focus:ring-green-500 focus:ring-opacity-20 transition-all duration-300"
                                placeholder="새 비밀번호를 다시 입력하세요"
                            >
                        </div>

                        <div class="text-xs text-gray-500 bg-[#3a3a4a] rounded-lg p-3">
                            <p>💡 비밀번호 변경을 원하지 않는다면 위 필드들을 비워두세요.</p>
                        </div>
                    </div>

                    <!-- 계정 정보 -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-white border-b border-gray-600 pb-2">계정 정보</h3>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="bg-[#3a3a4a] rounded-lg p-4">
                                <div class="text-sm text-gray-400 mb-1">가입 방법</div>
                                <div id="signupMethod" class="text-white font-medium">-</div>
                            </div>
                            
                            <div class="bg-[#3a3a4a] rounded-lg p-4">
                                <div class="text-sm text-gray-400 mb-1">가입일</div>
                                <div id="joinDate" class="text-white font-medium">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- 버튼 그룹 -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-6">
                        <button
                            type="button"
                            onclick="window.history.back()"
                            class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-medium py-3 px-6 rounded-xl transition-all duration-200"
                        >
                            취소
                        </button>

                        <button
                            type="submit"
                            class="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-medium py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl"
                        >
                            저장하기
                        </button>
                    </div>
                </form>

                <!-- 회원 탈퇴 섹션 (위험 영역) -->
                <div class="mt-12 border-t border-red-500/20 pt-8">
                    <h3 class="text-lg font-semibold text-red-400 mb-4">위험 영역</h3>
                    <div class="bg-red-500/10 border border-red-500/20 rounded-xl p-6">
                        <div class="flex items-start space-x-3 mb-4">
                            <svg class="w-6 h-6 text-red-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            <div>
                                <h4 class="text-white font-medium mb-2">회원 탈퇴</h4>
                                <p class="text-sm text-gray-400 mb-2">회원 탈퇴 시:</p>
                                <ul class="text-sm text-gray-400 space-y-1 list-disc list-inside">
                                    <li>즉시 로그인이 불가능합니다</li>
                                    <li>작성한 모든 퀴즈가 자동으로 비공개 처리됩니다</li>
                                    <li>퀴즈 및 활동 기록은 DB에 6개월간 보관됩니다</li>
                                    <li>6개월 후 모든 정보가 완전히 삭제됩니다</li>
                                    <li>법적 분쟁 시 수사기관에 정보가 제공될 수 있습니다</li>
                                </ul>
                            </div>
                        </div>
                        <button
                            type="button"
                            id="deleteAccountBtn"
                            class="w-full sm:w-auto bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-6 rounded-xl transition-all duration-200"
                        >
                            회원 탈퇴하기
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 오류 상태 -->
        <div id="errorSection" class="hidden text-center py-12">
            <div class="bg-red-500/10 border border-red-500/20 rounded-xl p-8">
                <h2 class="text-xl font-semibold text-red-400 mb-2">오류가 발생했습니다</h2>
                <p class="text-gray-400 mb-4">사용자 정보를 불러올 수 없습니다.</p>
                <button 
                    onclick="window.location.reload()" 
                    class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg transition-colors"
                >
                    다시 시도
                </button>
            </div>
        </div>
    </div>

    <script type="module" src="/js/edit-profile.js"></script>
</body>
</html>