PLAYCODE.GG 시스템 아키텍처 (클러스터 모드 포함)
==========================================

■ 전체 구조 (ASCII 다이어그램)
==========================================

┌─────────────────────────────────────────────────────────────┐
│                        Client Layer                          │
├─────────────────────────────────────────────────────────────┤
│  Web Browser (HTML5, CSS3, JavaScript, TailwindCSS)         │
│                                                               │
│  ┌─────────────┐  ┌─────────────┐  ┌──────────────┐        │
│  │  Game UI    │  │  Quiz Editor│  │  Community   │        │
│  │  (Real-time)│  │             │  │  (댓글/추천)  │        │
│  └─────────────┘  └─────────────┘  └──────────────┘        │  
└─────────────────────────────────────────────────────────────┘
         │                    │                    │
         │ Socket.IO          │ HTTP/HTTPS        │ HTTP/HTTPS
         │ (WebSocket)        │ (REST API)        │ (REST API)
         ▼                    ▼                    ▼
                    ┌─────────┼─────────┐
                    ▼         ▼         ▼
┌──────────────────────────────────────────────────────────────┐
│      Application Layer (AWS EC2 - PM2 Cluster Mode)          │
├──────────────────────────────────────────────────────────────┤
│     단일 포트, PM2가 여러 Worker 프로세스로 요청 자동 분배    │
│                                                                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │  Worker 1    │  │  Worker 2    │  │  Worker N    │       │
│  │  (Process)   │  │  (Process)   │  │  (Process)   │       │
│  ├──────────────┤  ├──────────────┤  ├──────────────┤       │
│  │ Node.js      │  │ Node.js      │  │ Node.js      │       │
│  │ + Express    │  │ + Express    │  │ + Express    │       │
│  │ + Socket.IO  │  │ + Socket.IO  │  │ + Socket.IO  │       │
│  └──────────────┘  └──────────────┘  └──────────────┘       │
│         │                 │                 │                 │
│         └─────────────────┼─────────────────┘                │
│                           │                                   │
└───────────────────────────┼───────────────────────────────────┘
                            │
                ┌───────────┼───────────┐
                ▼           ▼           ▼
┌────────────────────────┐  ┌─────────────────────────────────┐
│   Data Layer (Redis)   │  │   Database Layer                 │
├────────────────────────┤  ├─────────────────────────────────┤
│                        │  │                                  │
│  ┌──────────────────┐ │  │   ┌────────────────┐            │
│  │  Redis Server    │ │  │   │    MongoDB     │            │
│  ├──────────────────┤ │  │   ├────────────────┤            │
│  │ 1. 세션 공유     │ │  │   │ • 사용자 정보   │            │
│  │ 2. 동시성 제어   │ │  │   │ • 퀴즈 데이터   │            │
│  │    (SET NX)      │ │  │   │ • 게임 결과     │            │
│  │ 3. Pub/Sub       │ │  │   │ • 댓글/추천     │            │
│  │    (Socket.IO)   │ │  │   │ • S3 키 저장   │            │
│  │ 4. 첫정답자 판정 │ │  │   └────────────────┘            │
│  └──────────────────┘ │  │                                  │
│                        │  │   ┌────────────────┐            │
└────────────────────────┘  │   │    AWS S3      │            │
                            │   ├────────────────┤            │
                            │   │ • 퀴즈 이미지   │            │
                            │   │ • 썸네일        │            │
                            │   │ • Presigned    │            │
                            │   │   URL 제공     │            │
                            │   └────────────────┘            │
                            └─────────────────────────────────┘


■ 클러스터 모드의 핵심 역할
==========================================

┌─────────────────────┬─────────────────────────────────────────┐
│ 컴포넌트            │ 클러스터 환경에서의 역할                 │
├─────────────────────┼─────────────────────────────────────────┤
│ PM2 Cluster Mode    │ • 여러 Worker에 자동 트래픽 분산         │
│                     │ • 프로세스 자동 관리 및 재시작           │
│                     │ • 무중단 재배포 (reload)                 │
├─────────────────────┼─────────────────────────────────────────┤
│ Multiple Workers    │ • CPU 코어 수만큼 프로세스 실행          │
│ (Process)           │ • 단일 장애점 제거                       │
│                     │ • 높은 가용성 & 처리량 증가              │
├─────────────────────┼─────────────────────────────────────────┤
│ Redis Pub/Sub       │ • Worker 간 Socket.IO 메시지 브로드캐스트│
│                     │ • 같은 방의 유저가 다른 Worker에 있어도  │
│                     │   실시간 통신 가능                       │
├─────────────────────┼─────────────────────────────────────────┤
│ Redis 세션 공유     │ • 모든 Worker가 동일한 세션 데이터 접근  │
│                     │ • 재접속 시 다른 Worker로 연결되어도 OK  │
├─────────────────────┼─────────────────────────────────────────┤
│ Redis 동시성 제어   │ • SET NX로 여러 Worker에서 동시 요청 시  │
│                     │   첫 정답자 판정 정확히 처리             │
│                     │ • Race Condition 완벽 해결               │
└─────────────────────┴─────────────────────────────────────────┘


■ 주요 데이터 흐름 (클러스터 환경)
==========================================

1. 퀴즈 생성 흐름
   Client → Worker (PM2가 자동 분배)
         → MongoDB (퀴즈 메타데이터)
         → AWS S3 (이미지 업로드)
         → MongoDB (S3 키 저장)

2. 게임 시작 흐름 (실시간 통신)
   Client → Worker A (PM2가 자동 분배)
         → Redis (세션 생성)
         → MongoDB (퀴즈 데이터)
         → AWS S3 (Presigned URL)
         → Client

3. 정답 제출 흐름 (동시성 제어 - 여러 Worker에서 동시 처리)
   Client A → Worker 1 ┐
   Client B → Worker 2 ├→ Redis SET NX (첫 정답자 판정 - 원자적)
   Client C → Worker 3 ┘
                       └→ Redis (점수 업데이트)
                       └→ Redis Pub/Sub (순위 업데이트 메시지)
                       └→ 모든 Worker가 구독
                       └→ Socket.IO Broadcast → 모든 Clients

4. 실시간 채팅 (크로스 Worker 통신)
   Client A (Worker 1) → Socket.IO → Redis Pub/Sub
                                   → Worker 2 구독
                                   → Client B (Worker 2) 수신

5. 재접속 시나리오
   Client → Worker 2 (PM2가 분배, 이전엔 Worker 1이었음)
         → Redis에서 세션 복원
         → 게임 상태 정상 복원


■ 확장성 개선 포인트 (클러스터 모드)
==========================================

[Before] 단일 프로세스 아키텍처
- 1개의 Node.js 프로세스
- 단일 CPU 코어만 사용
- 프로세스 죽으면 서비스 중단
- 확장성 한계: 1,000 세션

[After] 클러스터 모드 아키텍처
- CPU 코어 수만큼 Worker 프로세스 (예: 4코어 = 4 Worker)
- 모든 CPU 코어 활용
- 1개 Worker 죽어도 서비스 계속 가능
- Redis로 Worker 간 상태 공유
- 확장성: 10,000+ 세션 (10배 개선)


■ 핵심 기술 결정 이유 (클러스터 관점)
==========================================

┌─────────────────┬──────────────────────────────────────────────┐
│ 기술            │ 클러스터 환경에서 선택한 이유                 │
├─────────────────┼──────────────────────────────────────────────┤
│ PM2             │ • CPU 멀티코어 완전 활용                      │
│ Cluster Mode    │ • 자동 프로세스 관리 및 재시작                │
│                 │ • 무중단 배포 (reload) 지원                   │
├─────────────────┼──────────────────────────────────────────────┤
│ Redis           │ • Worker 간 세션/상태 공유 (In-Memory)        │
│                 │ • Pub/Sub으로 실시간 메시지 브로드캐스트      │
│                 │ • 원자적 연산(SET NX)으로 동시성 제어         │
│                 │ • 클러스터 모드의 필수 컴포넌트               │
├─────────────────┼──────────────────────────────────────────────┤
│ Socket.IO       │ • Redis Adapter 지원 (socket.io-redis)        │
│ Redis Adapter   │ • 여러 Worker 간 자동 메시지 라우팅           │
│                 │ • 크로스 Worker 실시간 통신                   │
├─────────────────┼──────────────────────────────────────────────┤
│ MongoDB         │ • 여러 Worker에서 동시 접근 가능              │
│                 │ • Connection Pooling으로 효율적 관리          │
├─────────────────┼──────────────────────────────────────────────┤
│ AWS S3          │ • Worker 수와 무관하게 독립적 스토리지        │
│                 │ • Presigned URL로 클라이언트 직접 업로드      │
└─────────────────┴──────────────────────────────────────────────┘


■ 클러스터 모드 핵심 성과
==========================================

✓ 동시 처리 능력: 1,000 세션 → 10,000+ 세션 (10배)
✓ CPU 활용률: 단일 코어 → 전체 코어 활용
✓ 가용성: 단일 장애점 제거, 무중단 서비스
✓ 동시성 제어: Redis SET NX로 Race Condition 100% 해결
✓ 실시간 통신: Redis Pub/Sub으로 크로스 Worker 메시징


■ 다이어그램 작성 시 포함할 요소
==========================================

1. 계층 구분: Client / Load Balancer / Application(Cluster) / Data / Storage
2. 여러 Worker 프로세스 표현 (Worker 1, 2, N...)
3. Redis의 역할 명시:
   - 세션 공유
   - Pub/Sub (Socket.IO 메시지)
   - 동시성 제어 (SET NX)
4. Load Balancer 표시 (Nginx 또는 AWS ALB)
5. 데이터 흐름 화살표 (특히 Redis Pub/Sub)
6. 색상 구분 추천:
   - 파란색: Client Layer
   - 회색: Load Balancer
   - 녹색: Application Layer (Worker들)
   - 빨간색: Redis (핵심!)
   - 주황색: MongoDB
   - 보라색: AWS S3


■ 포트폴리오에 강조할 포인트
==========================================

📌 "클러스터 모드로 프로덕션 레벨 확장성 확보"
   - CPU 멀티코어 활용
   - Redis 기반 Worker 간 상태 공유
   - 무중단 서비스 (High Availability)

📌 "Redis Pub/Sub으로 분산 환경 실시간 통신"
   - 여러 Worker에 있는 클라이언트 간 실시간 채팅
   - Socket.IO Redis Adapter 활용

📌 "원자적 연산(SET NX)으로 분산 환경 동시성 제어"
   - 여러 Worker에서 동시 정답 제출 처리
   - Race Condition 완벽 해결


■ 추천 다이어그램 도구
==========================================

- draw.io (무료, 웹 기반) ⭐ 추천
- Excalidraw (무료, 손그림 스타일)
- Figma (무료, 협업 가능)
- Lucidchart (유료, 전문적)


■ 간단 버전 (포트폴리오에 삽입용)
==========================================

            [Client Browser]
                  ↕
    [PM2 Cluster Mode - 단일 포트]
          ↕        ↕        ↕
    [Worker1] [Worker2] [WorkerN] (AWS EC2)
          ↕        ↕        ↕
          └────[Redis]─────┘  ← Pub/Sub, 세션공유, 동시성제어
                  ↕
          ┌───────┼───────┐
          ↓       ↓       ↓
      [MongoDB] [AWS S3]


■ 포트폴리오 삽입 위치 제안
==========================================

**3페이지 "핵심 성과" 앞에 "시스템 아키텍처" 섹션 추가**

구성:
1. 제목: "시스템 아키텍처 (클러스터 모드)"
2. 다이어그램 이미지
3. 핵심 포인트 3-4개 (클러스터 모드 강조)
   - CPU 멀티코어 활용한 확장성 10배 개선
   - Redis 기반 분산 환경 동시성 제어
   - Pub/Sub으로 크로스 Worker 실시간 통신
   - 무중단 서비스 (High Availability)


==========================================
💡 TIP: 면접 시 예상 질문
==========================================

Q: "왜 클러스터 모드를 선택했나요?"
A: 단일 프로세스는 CPU 1코어만 사용하고 확장성에 한계가 있었습니다.
   클러스터 모드로 모든 코어를 활용하고, Redis로 Worker 간 상태를
   공유하여 10배 이상의 확장성을 확보했습니다.

Q: "클러스터 환경에서 동시성 문제를 어떻게 해결했나요?"
A: 여러 Worker에서 동시에 같은 요청을 처리할 수 있어 Race Condition이
   발생할 수 있습니다. Redis의 SET NX 원자적 연산으로 첫 정답자를
   정확히 판정하여 100% 해결했습니다.

Q: "Socket.IO를 여러 Worker에서 어떻게 동기화하나요?"
A: Socket.IO Redis Adapter를 사용합니다. Redis Pub/Sub을 통해
   한 Worker의 이벤트를 다른 Worker들이 구독하고, 모든 클라이언트에게
   실시간으로 브로드캐스트합니다.
